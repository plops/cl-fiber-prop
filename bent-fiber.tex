
\documentclass[DIV19,twocolumn]{scrartcl}

%\includeonly{spatio-angular}

%\usepackage{enumitem}
%\setitemize{noitemsep,topsep=0pt,parsep=0pt,partopsep=0pt}

%\usepackage{etoolbox}

\pdfminorversion=5
% 9 is best zlib compression i use 0 while writing in the hope that
% git can track changes more easily, set 0 0
\pdfcompresslevel=0
% 3 is maximum for now
\pdfobjcompresslevel=0


\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}
\usepackage[usenames,dvipsnames]{color}
%\usepackage[onehalfspacing]{setspace} 
%\usepackage[draft]{graphicx}
\usepackage{graphicx}
\usepackage{longtable}
\usepackage{float}
\usepackage{wrapfig}
\usepackage{soul}
\usepackage{amssymb}
\usepackage{amsmath}
%\usepackage{examplep}
%\usepackage{pdfcomment}  % breaks hyperref metadata

% choose font here: http://www.tug.dk/FontCatalogue/mathfonts.html
%\usepackage[T1]{fontenc}
%\usepackage[math]{iwona}
%\usepackage[math]{kurier}
%\usepackage{cmbright}
%\usepackage[scaled]{beramono}

\usepackage{footnote}

\usepackage{microtype}
\newcommand\Small{\fontsize{9}{9.2}\selectfont}
\newcommand*\LSTfont{\Small\ttfamily\SetTracking{encoding=*}{-60}\lsstyle}
\newcommand*\cmafont{\fontsize{8}{8.2}\selectfont\ttfamily\SetTracking{encoding=*}{-60}\lsstyle}


\usepackage{esvect} % vector CB in raytrace chapter



%\newcont\pdfcompresslevel


%\usepackage[hypertex,breaklinks]{hyperref} 
% breaklinks only seems to work with dvipdfm,
% otherwise urls have no
% line breaks

%\usepackage[showrefs,showcites,ignoreunlbld]{refcheck} % for draft, uncomment for final
%\usepackage[notref,notcite]{showkeys}

 \usepackage[disable]{todonotes} % for draft, disable for final

\usepackage{lineno}
\usepackage[refpage]{nomencl}
%\special{background Black}\special{color Green}
%\usepackage[utf8x]{inputenc} 
%\usepackage[T2A]{fontenc} % for the russian reference
\usepackage{wasysym} %diameter
% http://www.andy-roberts.net/misc/latex/latextutorial3.html

%\usepackage{url} % natbib.pdf p.11 break urls up, seems to be done
                 % with hyperref, though

\usepackage{natbib}

\usepackage[pdftex,a4paper=true,plainpages,bookmarksnumbered,pagebackref,% put after natbib
pdftitle={Light propagation through bent multi-mode fibers},%
pdfauthor={Martin Kielhorn},%
pdfkeywords={optical fibers, mode coupling}, %
pdfsubject={Technical Report}]{hyperref}


\usepackage{siunitx} %sudo apt-get install texlive-science
\usepackage{units}


% for app_hilo
\usepackage{listings}
\usepackage{color}
\usepackage{textcomp}
\usepackage{subfigure}


% \listfiles % show which files are loaded by tex

\bibpunct{(}{)}{;}{a}{}{,}
\makenomenclature
\newcommand{\vect}[1]{\mathbf{#1}}
\renewcommand{\r}{\vect r}
\renewcommand{\a}{\vect a}
\newcommand{\s}{\vect s}
\newcommand{\vnu}{\mbox{\boldmath{$\nu$}}}
\newcommand{\valpha}{\mbox{\boldmath{$\alpha$}}}
\newcommand{\vbeta}{\mbox{\boldmath{$\beta$}}}
\newcommand{\vmu}{\mbox{\boldmath{$\mu$}}}
\newcommand{\vtau}{\mbox{\boldmath{$\tau$}}}
\newcommand{\vrho}{\mbox{\boldmath{$\rho$}}}
\newcommand{\vvarrho}{\mbox{\boldmath{$\varrho$}}}
\newcommand{\supp}{\mathop{\mathrm{supp}}}
\newcommand{\pois}{\mathop{\mathrm{pois}}}
\newcommand{\step}{\mathop{\mathrm{step}}}
\newcommand{\diag}{\mathop{\mathrm{diag}}}
\def\a{\vect a}
\def\b{\vect b}
\def\k{\vect k}
\def\d{\vect d}
\def\e{\vect e}
\def\E{\vect E}
\def\f{\vect f}
\def\H{\vect H}
\def\c{\vect c}
\def\x{\vect x}
\def\y{\vect y}
\def\z{\vect z}
\def\q{\vect q}
\def\vzeta{\vect \zeta}
\def\p{\vect p}
\def\P{\vect P}
\def\l{\vect l}

\newcommand{\nvect}[1]{\vect{\widehat{#1}}}
%\renewcommand{\i}{\nvect i}
\newcommand{\vi}{\nvect \i}
\def\hc{\nvect c}
\def\hs{\nvect s}
\def\hd{\nvect d}
\def\hx{\nvect x}
\def\hy{\nvect y}

\def\hz{\nvect z}
\def\n{\widehat{\vect n}}
\def\t{\nvect t}
\def\m{\nvect m}
\def\vrho{\boldsymbol\rho}
\def\abs#1{\mathopen| #1 \mathclose|}
\def\({\left(}
\def\){\right)}

\newcommand{\nco}{n_\textrm{co}}
\newcommand{\rco}{r_\textrm{co}}
\newcommand{\neff}{n_\textrm{eff}}
\newcommand{\ncl}{n_\textrm{cl}}
\newcommand{\lmax}{l_\textrm{max}}
\newcommand{\mmax}{m_\textrm{max}}
\newcommand{\umax}{u_\textrm{max}}
\newcommand{\umin}{u_\textrm{min}}
\newcommand{\Ainfty}{A_\infty}

\renewcommand{\O}{\textsf{O}} % oxygen

% conclusions of paragraphs in the margin
%\usepackage[marginparwidth=2.5cm]{geometry}
\setlength{\marginparwidth}{2.2\marginparwidth}
\reversemarginpar
\newcommand{\cma}[1]{\marginpar{\cmafont{#1}}}
% include eps or pdf file, that was generated by inkscape, depending
% on if pdflatex or latex processes this file. latex allows a faster
% development cycle but pdflatex generates a smaller and better final
% pdf output
\def\svgending{\ifx\pdfoutput\undefined% 
  .eps_tex% 
  \else%
  .pdf_tex%
  \fi}

% use \svginput{1}{bla} to include bla.svg, make sure you keep this in
% one line, so that make can automatically find the dependencies with
% sed
\newcommand{\svginput}[2]{{\def\svgscale{#1}\input{#2\svgending}}}

\def\pdfending{\ifx\pdfoutput\undefined% 
  _vector.eps% 
  \else%
  _vector%
  \fi}
\newcommand{\pdfinput}[2]{\includegraphics[width=#1]{#2\pdfending}}

% example call \imagw{8cm}{bla.jpg}{bla}{caption abl}
\newcommand{\imagw}[4]{
  \begin{figure}[!hbt]
    \centering
    \includegraphics[width=#1]{#2}
    \caption{#4}
    \label{fig:#3}
  \end{figure}
}

\def\jpgending{\ifx\pdfoutput\undefined% 
  .eps% 
  \else%
  %
  \fi}
% use like this \jpginput{8cm}{imagefile}{caption ...  make sure all
% characters until the opening brace for the caption are on one line
\newcommand{\jpginput}[3]{\imagw{#1}{#2\jpgending}{#2}{#3}}

% this is for plots that are generated by gnuplot
\newcommand{\gnuplotinput}[2]{\begin{figure}[!hbt]%
    \centering%
    \includegraphics{#1_gnuplot}%
    \caption{#2}%
    \label{fig:#1}%
  \end{figure}}

\newcommand{\celegans}{\emph{C.~elegans}}
\DeclareMathOperator{\sign}{sign}
\DeclareMathOperator*{\sinc}{sinc}
\DeclareMathOperator*{\rect}{rect}

% reference to picture
\newcommand{\figref}[1]{\figurename~\ref{#1}}
\title{Light propagation through bent multi-mode fibers} % i don't call make title
\author{Martin Kielhorn}
% short summary at the beginning of a section
\newenvironment{summary}{\begin{quote}\small}{\end{quote}}

\begin{document}
\maketitle
\section{Introduction}
\section{Modes of a multi-mode fiber}
Das elektrische Feld einer rotationssymmetrischen Faser kann dargestellt werden als
\begin{align}
\E(r,\phi,z,t)=\P a \psi(r) e^{i(\omega t-\beta z \pm l \phi)}
\end{align}
mit einem beliebigen konstanten Polarisationsvektor $\P$, der
Ausbreitungskonstante $\beta$, der Amplitude $a$ und der
Drehimpulsquantenzahl $l$.

Das skalare Feld $\psi(r)$ ergibt sich als L\"osung der Differentialgleichung
\begin{align}
\label{eq:bessel-dgl}
\(\bullet_{,r^2} + \bullet_{,r}/r +k_0^2 n^2(r) -\beta^2 -l^2/r^2\)\psi(r) = 0
\end{align}
Ich beschr\"anke mich hier auf Stufenindexfasern mit kleinem
Indexkontrast. Ihre Brechzahlverteilung ist definiert als
\begin{align}
n(r)&=\nco\sqrt{1-2\Delta\theta(r-\rco)} \\
\theta(r)&=\begin{cases}0 &r<0,\\ 1 & r\ge 0\end{cases} \\
\Delta &= \frac{\nco^2-\ncl^2}{2\nco^2}
\end{align}
mit der Stufenfunktion $\Delta(r)$ und dem Profilh\"ohenparameter
$\Delta$. An der Sprungstelle des Brechungsindex m\"ussen sowohl
$\psi$ als auch $\psi_{,r}$ stetig \"ubergehen. F\"ur st\"uckweise konstante Brechzahl $n(r)$ ist Gleichung \eqref{eq:bessel-dgl} die Besselsche Differentialgleichung und hat die L\"osung
\begin{align}
  R&=r/\rco\\
  \psi(R)&=N\begin{cases}
  J_l(uR)/J_l(u), & 0\le R\le 1\\
  K_l(wR)/K_l(w), & 1<R<\infty 
  \end{cases}\label{eq:psi}\\
  u &= \rco k_0 \sqrt{\nco^2-\neff^2} \\
  w &= \rco k_0 \sqrt{\neff^2-\ncl^2} 
\end{align}
Die Terme im radialen Feld in Gleichung \eqref{eq:psi} sind so
skaliert, dass $\psi$ auf dem Rand $r=\rco$ stetig ist. Die Bedingung,
dass auch die Ableitung $\psi_{,r}$ am \"Ubergang vom Kern zum Mantel
stetig ist liefert die Eigenwertgleichung, oder charakteristische
Gleichung, zur Bestimmung des Modenparameters $u$
\begin{align}
  u\frac{J_{l+1}(u)}{J_l(u)}&=w\frac{K_{l+1}(w)}{K_l(w)}\\
  v^2 &= u^2+w^2\\
  v &= \rco k_0 \sqrt{\nco^2-\ncl^2}
\end{align}
Man kann zeigen, dass diese Gleichung f\"ur $0<v<2.405$ nur eine
einzig L\"osung hat (single-mode). Der Wertebereich f\"ur m\"ogliche
L\"osungen fuer $u$ liegt zwischen 0 und $v$. Bemerkenswert ist, dass
die durch $J_l(u)$ hervorgerufenen Polstellen in der
charakteristischen Gleichung jeweils eine Mode abgrenzen\footnote{Habe
  ich aus Quellcode von H.~Gross erfahren.}. Die Nullstellen der
Besselfunktion k\"onnen leicht mit einer Funktion aus einer
numerischen Bibliothek [Temme1979] bestimmt werden und die Eigenwerte
$u$ k\"onnen in den damit ermittelten Intervallen mit einer
Nullstellensuche, z.B. Brents Methode [Press2007], berechnet werden.
Bei der aktuellen Implementierung funktioniert diese Modensuche bis
ungef\"ahr 7000 Moden. Bei gr\"osseren $v$-Parametern kommt es zu
floating point overflows bei der Brechnung von $K_{l+1}(w)$ f\"ur etwa
$l>100$ und $w\approx 4$, das Problem liegt also bei zu gro\ss em
$l$. Zur Zeit ist mir nicht klar, ob ein anderer Algorithmus zur
Berechnung der charaketeristischen Funktion ausreicht oder ob zu einem
anderen Datentyp (insbesondere 128-bit quadfloat) gewechselt werden
muss. Das Verh\"altnis von Besselfunktionen kann man als continued
fraction schreiben [Stegun 9.1.73]. 

In [1964Marcatili] wird eine N\"aherungsloesung fuer die Eigenwerte
eines hohlen Wellenleiters entwickelt f\"ur Wellenleiterradien viel
gr\"o\ss er als die Wellenl\"ange $ka = 2\pi a/\lambda \gg |\nu|
u_{nm}$ (mit komplexem Index $\nu$). Uebertragen auf unser
Eigenwertproblem ergibt sich:

% k(n,z) := sqrt(%pi/(2*z))*exp(-z)*(1+(4*n*n-1)/(8*z)); taylor(k(n+1,z)/k(n,z),z,inf,1);
% k(n,z) := (n-1)!/2 *(2/z)^n;taylor(k(n+1,z)/k(n,z),z,0,1);
\begin{align}
  \lim_{z\rightarrow \infty} K_\nu(z) &\sim \sqrt{\frac{\pi}{2z}} e^{-z}\(1+\frac{\mu-1}{8z}\), \quad \mu=4\nu^2 \\ % stegun 9.7.2
  \lim_{z\rightarrow \infty} \frac{K_{\nu+1}(z)}{K_{\nu}(z)} &\sim 1+\frac{2\nu+1}{2z} \\
  \lim_{z\rightarrow 0} K_\nu(z) &\sim \frac{(\nu-1)!}{2} \(\frac{2}{z}\)^\nu \\ % snyder 37-86
  \lim_{z\rightarrow 0     } \frac{K_{\nu+1}(z)}{K_{\nu}(z)} &\sim \frac{2\nu}{z}
\end{align}
Der Fall $z\rightarrow \infty$ macht hier keinen Sinn, denn $w$ kann
maximal $v$ werden.
\begin{align}
  u\frac{J_{l+1}(u)}{J_l(u)}&=w+\frac{2l+1}{2}
\end{align}
Auf der anderen Seite, bei gut gef\"uhrten Moden gilt hingegen:
\begin{align}
  u\frac{J_{l+1}(u)}{J_l(u)}&=2l \\
  \lim_{z\rightarrow 0} J_\nu(z) &= (z/2)^\nu/\nu!  \\
    \lim_{z\rightarrow 0} \frac{J_{\nu+1}(z)}{J_{\nu}(z)} &\sim \frac{z}{2(\nu+1)} \\
    \frac{u^2}{l+1} &= l  
\end{align}


\begin{align}
  \frac{J_l(z)}{J_{l-1}(z)} &= \frac{1}{2lz^{-1}-} \frac{1}{2(l+1)z^{-1}-} \frac{1}{2(l+2)z^{-1} -}\cdots \\
  &= \frac{\frac{1}{2}z/l}{1-} \frac{\frac{1}{4}z^2/(l(l+1))}{1-} \frac{\frac{1}{4}z^2/(l(l+1)(l+2))}{1-} \cdots
\end{align}


Bei gegebenen Modenparameter $u$ kann die Ausbreitungskonstante
$\beta$ errechnet werden
\begin{align}
\beta = \frac{1}{\rco} \sqrt{\frac{v^2}{2\Delta} - u^2}
\end{align}
Die Normierungskonstante $N$ wird so gew\"ahlt, dass die Intensit\"at
$|a|^2$ wird
\begin{align}
  I &= \frac{1}{2}\left|\int_{A_\infty}\!\!\!\!\! \(\E\times\H^*\)_z  \textrm{d}A \right| = |a|^2
\end{align}
Da der Indexkontrast klein ist ($\Delta \ll 1$), k\"onnen longitudinale Feldkomponenten vernachl\"assigt werden und es gilt
\begin{align}
  \H(r,\phi,z,t) &= \frac{1}{\mu_0 \omega} \k \times \E, \quad\textrm{mit}\ \k = \beta \e_z
\end{align}
Damit ist die Normierungskonstante 
\begin{align}
  N \propto \frac{v^2}{2 u^2} \frac{K_{l-1}(w)K_{l+1}(w)}{K_l^2(w)}
\end{align}

Die Integrale sind [Snyder p. 716]: 
% taylor(z^2/2 * (bessel_k(l,a*z)^2- bessel_k(l-1,a*z)*bessel_k(l+1,a*z)),z,inf);
%bk(nu,z):=sqrt(%pi/(2*z))*exp(-z)*(1+(4*nu^2-1)/(8*z));
%assume(a>0);
%taylor(factor(expand(z^2/2 * (bk(l,a*z)^2- bk(l-1,a*z)*bk(l+1,a*z)))),z,inf,3);
\begin{align}
  I_\textrm{core}(z) &= \int z J_m^2(az) \textrm{d} z \\&= \frac{z^2}{2}(J_m^2(az)-J_{m-1}(az)J_{m+1}(az))\\
  I_\textrm{core} {}^1_0 &= \frac{1}{2}(J_m^2(a)-J_{m-1}(a)J_{m+1}(a)) \\
  I_\textrm{clad}(z) &= \int z K_m^2(az) \textrm{d} z \\&= \frac{z^2}{2}(K_m^2(az)-K_{m-1}(az)K_{m+1}(az)) \\
  \lim_{z\rightarrow \infty} K_\nu(z) &\sim \sqrt{\frac{\pi}{2z}} e^{-z}\(1+\frac{\mu-1}{8z}\), \quad \mu=4\nu^2 \\ % stegun 9.7.2
  \lim_{z\rightarrow \infty} I_\textrm{clad}(z)  & = \lim_{z\rightarrow \infty} -\frac{\pi}{4a^2}e^{-2az} \rightarrow 0 \\
  I_\textrm{clad} {}^\infty_1 &= \frac{1}{2}(K_m^2(a)-K_{m-1}(a)K_{m+1}(a)) 
\end{align}

\begin{figure}[hbtp]
  \centering
  \svginput{1}{modes}
  \caption{Modenfelder f\"ur $v=30$ in einer Matrix mit radialer
    Modenzahl $m$ und Drehimpulsquantenzahl $l$. Weiterhin ist auch
    ein Index eingetragen, der alle Moden ausgehend von der Grundmode
    linear indiziert.}
  \label{fig:fields}
\end{figure}
\section{Kubische Interpolation}
Geben sei eine Tabelle von Funktionswerten $y_i(x_i)$
$i=0,\ldots,N-1$. Die lineare Interpolation in einem Interval
$[x_j,x_{j+1}]$ ist
\begin{align}
  y &= Ay_j + By_{j+1} \\
  A &= \frac{x_{j+1}-x}{x_{j+1}-x_j}\quad B=1-A
\end{align}
Jetzt nehmen wir an, dass wir zus\"atzlich eine Tabelle der zweiten
Ableitungen $y''_i$ haben. Dann k\"onnen wir ein kubische Polynom zu
obigem Ausdruck addieren, dessen zweite Ableitung linear von $y''_j$
auf der linken Seite zu $y''_{j+1}$ auf der rechten Seite variiert.
\begin{align}
  y &= Ay_j + By_{j+1} + Cy''_j + Dy''_{j+1} \\
  C &= (A^3-A)(x_{j+1}-x_j)^2/6 \\
  D &= (B^3-B)(x_{j+1}-x_j)^2/6 
\end{align}
\section{Approximation von sinf}
Eine gut Approximation von f\"ur single float Sinus ist
\begin{align}
  \sin(x)&\approx 0.9999966 x -0.16664815 x^3 \nonumber\\
  &+0.008306204 x^5 -1.8360789\cdot 10^{-4} x^7 
\end{align}
Im Bereich $[-\pi/2,\pi/2]$ ist der Fehler $7.1\cdot 10^{-7}$.
F\"ur die Auswertung berechne ich:
\begin{align}
  \sin(x) \approx (c_1 + c_3 x) x^2 + ( (c_5 +c_7 x)x^2) x^4
\end{align}


%20 7 7.112727e-7 4 4 4 0 | 0.0 0.9999966 0.0 -0.16664815 0.0 0.008306204 0.0 -1.8360789e-4 | 0 16777159/16777216 0 -698973/4194304 0 8918719/1073741824 0 -6308719/34359738368 | sin-F4669396D2C9F733C95387153E86BA05
% from https://github.com/pkhuong/polynomial-approximation-catalogue
\section{Vorgehensweise zur Berechnung der Modenfelder}
Um die Feldverteilung der einzelnen Moden auszurechnen, kann man
einige Zwischenergebnisse wiederverwenden.

Folgende Funktionen und ihre Ableitungen kann man tabellieren und
sp\"ater mit Spline-Interpolation auswerten um 2D Felder
radialsymmetrisch zu f\"ullen: $\cos(l\phi)$ und $\sin(l\phi)$ mit
$\phi\in[0,2\pi)$ und $l\in[0,\lmax]$. Die maximale Anzahl
Oszillationen auf dem Kernrand h\"angt von $\lmax$ ab. Dies definiert
eine Grenze f\"ur die Pixelgr\"osse des Feldes. Es reicht eine
zyklische lookup Tabelle (oder Interpolation) f\"ur
$[\sin(x),-\cos(x),\sin(x)]$ und $[\cos(x),\sin(x),-\cos(x)]$ f\"ur $l=1$.
[Press2007, Function approximization Ch 5]

% factor(diff(bessel_j(l,x),x,2));
% diff(bessel_j(0,x),x,2);
% factor(diff(bessel_j(1,x),x,2));

Der maximale Wert f\"ur $u$ ist $v$, also reicht f\"ur die
Feldberechnung im Kern $J_l(x)$ mit
$x\in[0,v]$ und $l\in[0,\lmax]$. 
\begin{align}
  J''_0(x) &= \frac{1}{2}\(J_2(x)-J_0(x)\)\\
  J''_1(x) &= \frac{1}{4}\(J_3(x)-3J_1(x)\)\\
  J''_l(x) &= \frac{1}{4}\(J_{l+2}(x)-2J_l(x)+J_{l-2}(x)\)
\end{align}
Hierbei wurde die Eigenschaft $J_{-n}(x) = (-1)^n J_n(x)$ von
Besselfunktionen mit ganzzahliger Ordnung angewendet.

Die Anzahl der radialen Oszillationen ist maximal f\"ur $J_0(v)$. Dies
liefert eine weitere Grenze f\"ur die Pixelgr\"osse des Feldes.

Die Argumente f\"ur die Funktion $K_l(x)$ erstrecken sich von $w$ nach
unendlich. Das kleinste $w$ ist $\sqrt{v^2-\umax^2}$. Dieser Wert kann
meineserachtens null werden. Verglichen mit $J_l$ sieht $K_l$ sehr
langweilig aus. M\"oglicherweise ist es hilfreich, $K_l(x)\exp(x)$ zu
tabellieren aber die Feldstaerke gef\"uhrter Moden in von uns
betrachteten Multi-mode Fasern faellt ausserhalb des Kernradius
schnell ab und der Einfluss auf Kopplungskonstanten ist
vernachlaessigbar.

% factor(diff(bessel_k(0,x),x,2));
% factor(diff(bessel_k(1,x),x,2));
% factor(diff(bessel_k(l,x),x,2));
% factor(diff(bessel_k(l,x)*exp(x),x,2));

\begin{align}
  K''_0(x) &= \frac{1}{2}\(K_2(x)+K_0(x)\)\\
  K''_1(x) &= \frac{1}{4}\(K_3(x)+3K_1(x)\)\\
  K''_l(x) &= \frac{1}{4}\(K_{l+2}(x)+2K_l(x)+K_{l-2}(x)\)
\end{align}
Hier gilt $K_{-l}(x) = K_l(x)$ [Stegun p 375]. 

F\"ur die skalierte Besselfunktion $k_l(x)=K_l(x)e^x$ sind die zweiten Ableitungen
\begin{align}
  k''_0(x) &= \frac{1}{2}\(k_2(x)-4k_1(x)+3k_0(x)\)\\
  k''_1(x) &= \frac{1}{4}\(k_3(x)-4k_2(x)+7k_1(x)-4k_0(x)\)\\
  k''_l(x) &= \frac{1}{4}\big(k_{l+2}(x)-4k_{l+1}(x)+6k_l(x) \nonumber \\ 
&  -4k_{l-1}(x)+k_{l-2}(x)\big)
\end{align}


Um die Eigenwerte als lineare Sequenz aufzufassen benutzt H.~Gross das
Indexschema, dass durch die roten Zahlen im Mosaik der Modenfelder
angedeutet ist. F\"ur jedes $l$ wird die Anzahl der radialen Moden
$\mmax(l)$ gespeichert und der laufende Index $j$ kann erzeugt werden
durch
\begin{align}
  j &= \begin{cases}
    m & l=0\\
    m+\mmax(0) & l=1\\
    m+\mmax(0)+\mmax(1) & l=1\\
    m+\mmax(0)+ 2\sum_{k=1}^l \mmax(k) & l>1 \\
    m+\mmax(0)+ 2\(\sum_{k=1}^{|l|} \mmax(k)\) + \mmax(|l|) & l<-1
\end{cases}
\end{align}

\section{Kopplung zweier gerader Faserst\"ucken}
[1989Hill]
Ausgehend von einer Modenverteilung in geraden Faserst\"ucken, kann
die Kopplung durch einen Phasenkeil mit Winkel $\alpha$ vermittelt
werden:
\begin{align}
  F_{j(l,m)}(r,\phi) &= \psi(r) 
  \begin{cases}
    \cos(l \phi) & l>0\\  
    \sin(l \phi) & l<0
  \end{cases} \\
  \delta L &= R_b \sin\alpha\\
  c_{nm}&=\int\!\!\!\int\! F_n(x,y)F_m(x,y) e^{ik_0\alpha x} \textrm{d}x \textrm{d}y
\end{align}

Alternativ kann man auch bez\"uglich Zylinderkoordinaten
integrieren. Damit l\"a\ss t sich besser feststellen ob ausreichend
Rand mit einbezogen wurde.

\begin{align}
  \Re\{c_{nm}\}&=\int_0^{\infty}\!\!\!\!\int_0^{2\pi}\!\!\!\!\!\! \cos(n\phi)\cos(m\phi) \cos(k_0\alpha x) \textrm{d}\phi\, \psi_n(r) \psi_m(r) r\, \textrm{d}r 
\end{align}

Hier bricht $x=r \cos(\phi)$ die Zylindersymmetrie, aber verglichen
mit den oszillierenden Termen aus den Feldern ist die Funktion
$\cos(k_0\alpha x)$ f\"ur kleine Tiltwinkel $\alpha$ langsam
ver\"anderlich. Ausserdem kann man das Produkt
$\cos(l\phi)\cos(m\phi)$ der zwei azimuthalen Feldfunktionen als Summe
von Oszillationen mit der Differenz- und Summenfrequenzen schreiben:

% a:trigsimp(demoivre(expand(exponentialize(cos(l*x)*cos(m*x)))));
% b:trigsimp(demoivre(expand(exponentialize(cos(l*x)*sin(m*x)))));
% c:trigsimp(demoivre(expand(exponentialize(sin(l*x)*sin(m*x)))));

% integrate(cos(l*x)*exp(%i*z*cos(x)),x,0,2*%pi);
% integrate(cos(l*x)*cos(z*cos(x)),x,0,2*%pi);

\begin{align}
  I_\phi(r) = \int_0^{2\pi}\!\!\!\!\!\! \cos(l\phi)\cos(m\phi) e^{ik_0\alpha\rho r\cos(\phi)} \textrm{d}\phi = \nonumber \\
  \frac{1}{2}\int_0^{2\pi}\!\!\!\!\!\! \cos\((l+m)\phi\) e^{ik_0\alpha\rho r\cos(\phi)} \textrm{d}\phi  \nonumber \\
  + \frac{1}{2}\int_0^{2\pi}\!\!\!\!\!\! \cos\((l-m)\phi\) e^{ik_0\alpha\rho r\cos(\phi)} \textrm{d}\phi \nonumber \\
  =  \int_0^{\pi}\! e^{ik_0\alpha\rho r\cos(\phi)} \cos\((l+m)\phi\) \textrm{d}\phi  \nonumber \\
  + \int_0^{\pi}\! e^{i\underbrace{k_0\alpha\rho r}_z\cos(\phi)} \cos\((l-m)\phi\)  \textrm{d}\phi
\end{align}

Hierbei ist $x=\rho r \cos(\phi)$.

Beide Integrale entsprechen einer Besselfunktion gem\"ass der
Gleichung:
\begin{align}
  J_n(z) = \frac{i^{-n}}{\pi}\int_0^\pi e^{iz\cos\theta} \cos(n \theta) \textrm{d} \theta
\end{align}

\begin{align}
  I_\phi(r) &= \pi \(i^{l+m} J_{l+m}(k_0\alpha\rho r)+i^{l-m} J_{l-m}(k_0\alpha\rho r)\)
\end{align}

Hier haben die offenbar voll abgefahrene Umformungen gemacht, aber im
Paper leider nicht hingeschrieben:
\begin{align}
J_{-l}(x) &= -J_l(x) \\
\sign \nu &= \nu<0 ? -1 : 1 = \nu/|\nu| = |\nu|/\nu \\
J_\nu(x) &= (-1)^{(\sign{\nu}-1)/2} J_{|\nu|}(x) \\ 
& = (-1)^{\frac{1}{2}(\nu/|\nu|-1)} J_{|\nu|}(x) \\ 
& = ((-1)^{\frac{1}{2}})^{\nu/|\nu|-1} J_{|\nu|}(x) \\ 
& = i^{\nu/|\nu|-1} J_{|\nu|}(x)\\
i^{-\mu} J_\mu(x) &= i^{-\mu} i^{\mu/|\mu|-1} J_{|\mu|}(x)\\
&= i^{\mu/|\mu|-1 -\mu } J_{|\mu|}(x) \\
&= i^{\mu/|\mu| -\mu } (-i) J_{|\mu|}(x) \\
&= i^{|\mu|/\mu-\mu} (-i) J_{|\mu|}(x) \\
&= i^{|\mu|/\mu-|\mu| |\mu| /\mu-1} J_{|\mu|}(x) \\
&= i^{|\mu|/\mu-|\mu| |\mu| /\mu-|\mu|/|\mu|} J_{|\mu|}(x)
\end{align}


Mir ist noch unklar, ob man das Integral analytisch f\"ur beliebige
Winkel l\"osen kann.  Bei der numerischen Auswertung des Azimuthalen
Integrals sollte man die Funktion \verb!integration_qawo()! anwenden,
die f\"ur oszillierende Integranden ausgelegt ist und eine Tabelle mit
entsprechenden Chebyshev Momenten benutzt.

Das Integral im Inneren des Kerns kann mit der Funktion
\verb!integration_qag()! ausgewertet werden, die die Gauss-Kronrod
Regeln mit 15 bis 61 Punkten implementiert.  [2012Auluck] diskutiert
die Eigenschaften und eine Approximation des dreifachen Bessel
Integrals, das brauche ich aber hier nicht weiter.
\begin{align}
    c_{nm}^\textrm{in}&=\frac{N_n N_m}{J_n(u_n) J_m(u_m)}
    \int_0^1\!\!\!\! I_\phi(r) J_n(u_n r) J_m(u_m r) r\, \textrm{d}r 
\end{align}

Das Integral ausserhalb des Kerns kann mit der Funktion
\verb!integration_qagiu()! ausgewertet werden, die das Interval
$(a,\infty)$ mit der Transformation $r=a+(1-t)/t$ auf $(0,1]$
abbildet.

\begin{align}
    c_{nm}^\textrm{out}&=\frac{N_n N_m}{K_n(w_n) K_m(w_m)}
    \int_1^\infty\!\!\!\! I_\phi(r) K_n(w_n r) K_m(w_m r) r\, \textrm{d}r 
\end{align}



\begin{figure}[hbtp]
  \centering
  \includegraphics[width=.7\columnwidth]{bla-coef}
  \includegraphics[width=.7\columnwidth]{bla-coef-phase}
  \caption{Kopplungskonstanten zwischen den 246 Moden f\"ur $v=32$
    oben Absolutbetrag, unten Phase. $\lambda=\unit[500]{nm}$, wedge
    angle $\alpha=\unit[2]{mrad}$.}
  \label{fig:coef}
\end{figure}

\section{Propagation entlang der Faser}
\begin{align}
E_{j(l,m)}(r,\phi,z) = \psi_m(r)e^{-\beta_j z+ l\phi}
\end{align}

\section{Einkopplung in die Faser}
incident beam is tilted towards fiber axis
and fresnel reflection 
[snyder]
\begin{align}
n_i \sin(\theta_i) &= \nco \sin(\theta_z)\\
\E_t(\theta_z) &= \frac{2 n_i}{\nco+n_i} \E_i(\theta_i)
\end{align}

Schreibe alle Samplewerte des Eingangsfeldes mit minimalen
Absolutbetrag
\begin{align}
  \Omega = \{(x,y)\in\Ainfty: |E_t(x,y)| > \kappa\}
\end{align}
in einen Vektor $w_i = E_t(\Omega_i)$. Konstruiere eine Matrix $Z$
deren Zeilen den entsprechenden Wert der verschiedenen Moden mit
linearem Index $j$ an den Punkten aus der Menge $\Omega$ <enthaelt:
\begin{align}
  Z_{ij} = u_j(\Omega_i) 
\end{align}
Die Normal equation des least square problems:
\begin{align}
(w^T Z) (Z^T Z)^{-1}
\end{align}

Das ist genauer in 15.4.2 numerical recipes 3rd ed beschrieben:
Das lineare Modell sei
\begin{align}
  y(x) = \sum_{k=0}^{M-1} a_k X_k(x)
\end{align}
mit den Basisfunktionen $X_k$. Im Folgenden beschreibt $M$ die Anzahl
der Moden und $N$ die Anzahl an Positionen, an denen eine elektrische
Feldstaerke gemessen wurde. Die Merit Funktion ist
\begin{align}
  \chi^2 = \sum_{i=0}^{N-1}\frac{1}{\sigma_i^2}\(y_i- \sum_{k=0}^{M-1} a_k X_k(x_i\)^2
\end{align}
Die Design Matrix A sei eine Matrix mit $N\times M$ komponenten aus
$M$ Basisfunktionen und $N$ Koordinatenpunkten $x_i$ mit $N$
Messfehlern $\sigma_i$.
\begin{align}
  A_{ij} = X_j(x_i)/\sigma_i
\end{align}
Es sollte gelten $N\ge M$, wir fordern mehr Datenpunkte als
Modelparameter. Weiterhin definieren wir den Datenvektor $\b$ der L\"ange N mit
\begin{align}
  b_i = y_i/\sigma_i
\end{align}
und den Parametervektor $\a$ mit $M$ Eintr\"agen.
\begin{align}
  \a = (a_0, a_1,\dots,a_{M-1})
\end{align}
Um die optimalen Parameter zu bestimmen fordern wir, dass die
Ableitung $\chi^2_{,a_k}$ der Meritfunktion nach allen Parametern
verschwindet. Damit ergeben sich $M$ Gleichungen:
\begin{align}
  0 = \sum_{i=0}^{N-1}\frac{1}{\sigma_i^2}\(y_i- \sum_{j=0}^{M-1} a_j X_j(x_i)\) X_k(x_i) 
\end{align}
mit $k=0,\ldots, M-1$.  Wir vertauschen die Summen um diesen
Ausdruck in Matrixschreibweise bringen:
\begin{align}
  0 &= \sum_{i=0}^{N-1}\(\frac{y_iX_k(x_i)}{\sigma_i^2}- \sum_{j=0}^{M-1} \frac{a_j X_j(x_i)X_k(x_i)}{\sigma_i^2}\)   \\
0 &=\sum_{i=0}^{N-1} \frac{y_iX_k(x_i)}{\sigma_i^2}- \sum_{j=0}^{M-1} \sum_{i=0}^{N-1} \frac{a_j X_j(x_i)X_k(x_i)}{\sigma_i^2}
\end{align}
\begin{align}
\sum_{j=0}^{M-1} \underbrace{\sum_{i=0}^{N-1}  \frac{X_j(x_i)X_k(x_i)}{\sigma_i^2}}_{\alpha_{kj}} a_k =  \underbrace{\sum_{i=0}^{N-1}\frac{y_iX_k(x_i)}{\sigma_i^2}}_{\beta_k} 
\end{align}
\begin{align}
  \sum_{j=0}^{M-1} \alpha_{kj} a_j = \beta_k
\end{align}
Dabei ist $\valpha$ eine $M\times M$ Matrix und $\vbeta$ ein Vektor
der L\"ange $M$. Als Matrixgleichung geschrieben:
\begin{align}
  \valpha \a = \vbeta
\end{align}
oder
\begin{align}
  \valpha &= A^T A\\
  \vbeta &= A^T \b\\
  (A^T A) \a &= A^T \b
\end{align}
Dieses System sollte mit SVD gel\"ost werden. Die Zerlegung einer Matrix $A$ ist 
\begin{align}
  \begin{pmatrix}
  &&&&\\
  &&&&\\ 
  &&A&&\\
  &&&&\\
  &&&&\\ 
  \end{pmatrix}
  =
  \begin{pmatrix}
  &&&&\\
  &&&&\\ 
  &&U&&\\
  &&&&\\
  &&&&\\
  \end{pmatrix}
  \underbrace{
  \begin{pmatrix}
  w_0 \\
  {} & w_1 \\
  {} & {} & \ddots \\
  {} & {} & {} & w_{N-1}
  \end{pmatrix}}_S
  \begin{pmatrix}
  &&\\ 
  & V^T &\\
  &&\\
  \end{pmatrix}
\end{align}
Wir bezeichen mit $U_{(i)}$ die $M$ Spalten von $U$ (Vektoren der
L\"ange $N$) und mit $V_{(i)}$ die $M$ Spalten von $V$ (Vektoren der
L\"ange $M$). Damit ist die L\"osung des linearen
Minimierungsproblems $\min |A\a-\b|^2$ :
\begin{align}
  \a = \sum_{i=0}^{M-1} \(\frac{U_{(i)}\b}{w_i}\)  V_{(i)}
\end{align}
F\"ur kleine Werte von $w_i$ muss der entsprechende Summand Null
gesetzt werden.  Der Fehler der abgesch\"atzten Parameter ergibt sich
als
\begin{align}
  \sigma^2(a_j) = \sum_{i=0}^{M-1} \(V_{ji}/w_i\)^2
\end{align}
Die GNU Scientific Library stellt f\"ur diese Aufgabe die Funktionen \verb!SV_decomp(A,V,S,vec work)! und  \verb!SV_solve(U,V,S,vec b,vec x)! bereit.

\end{document}

%%% Local Variables: 
%%% mode: latex
%%% TeX-master: t
%%% eval: (reftex-mode)
%%% eval: (flyspell-mode)
%%% End: 
